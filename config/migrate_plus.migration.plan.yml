uuid: 70e44963-adfa-468f-bbcc-fa37f546d128
langcode: en
status: true
dependencies:
  enforced:
    module:
      - hpc_api
_core:
  default_config_hash: Lkwz7_i92cNdynojqgt6zv6vfOyzQBaFWG9_5nyMCb8
id: plan
class: null
field_plugin_method: null
cck_plugin_method: null
migration_tags:
  - 'HPC API'
migration_group: hpc_data
label: 'Plans from the HPC API'
source:
  plugin: hpc_api_url
  data_fetcher_plugin: hpc_api_http
  data_parser_plugin: hpc_api_endpoint
  include_raw_data: true
  track_changes: true
  endpoints:
    -
      endpoint: 'plan?scopes=tags,locations&activities=false'
      api_version: v2
      auth_method: api_key
  item_selector: data
  fields:
    -
      name: original_id
      label: 'Unique plan ID'
      selector: id
    -
      name: name
      label: 'Plan name'
      selector: planVersion/name
    -
      name: plan_year
      label: 'Plan year'
      selector: years/0/year
    -
      name: plan_code
      label: 'Plan code'
      selector: planVersion/code
    -
      name: locations
      label: 'Country References for plan'
      selector: locations
    -
      name: restricted
      label: Restricted
      selector: restricted
    -
      name: uses_projects_module
      label: 'Uses projects module'
      selector: planVersion/isForHPCProjects
    -
      name: plan_start_date
      label: 'Plan Start Date'
      selector: planVersion/startDate
    -
      name: plan_end_date
      label: 'Plan End Date'
      selector: planVersion/endDate
    -
      name: condition_fields
      label: 'Condition fields'
      selector: conditionFields
  ids:
    original_id:
      type: integer
process:
  type:
    plugin: default_value
    default_value: plan
  title: name
  field_original_id: original_id
  field_plan_year: plan_year
  field_plan_code: plan_code
  field_plan_type:
    -
      plugin: extract_category_id
      category_group: planType
      source: categories
    -
      plugin: migration_lookup
      migration: plan_type_term
      no_stub: true
  field_plan_costing:
    -
      plugin: extract_category_id
      category_group: planCosting
      source: categories
    -
      plugin: migration_lookup
      migration: plan_costing_term
      no_stub: true
  field_country_references:
    -
      plugin: sub_process
      source: locations
      process:
        target_id:
          plugin: migration_lookup
          migration: locations
          source: id
          no_stub: true
  field_restricted:
    plugin: skip_on_value
    source: restricted
    method: row
    value: true
  field_plan_uses_projects_module: uses_projects_module
  field_plan_date/value:
    -
      plugin: ghi_migrate_format_date
      source: plan_start_date
  field_plan_date/end_value:
    -
      plugin: ghi_migrate_format_date
      source: plan_end_date
  sticky:
    plugin: default_value
    default_value: 0
  uid:
    plugin: default_value
    default_value: 0
destination:
  plugin: 'entity:node'
  overwrite_properties:
    - title
    - field_plan_year
    - field_plan_code
    - field_plan_type
    - field_plan_costing
    - field_country_references
    - field_plan_uses_projects_module
    - field_plan_date
migration_dependencies: {  }
