uuid: 6741b9eb-64c2-4c1d-8891-db9a5808b32f
langcode: en
status: true
dependencies:
  enforced:
    module:
      - hpc_api
id: plan
class: null
field_plugin_method: null
cck_plugin_method: null
migration_tags: null
migration_group: hpc_api_data
label: 'Plans from the HPC API'
source:
  filter:
    -
      type: min_year
      value: '2018'
  include_raw_data: true
  track_changes: true
  endpoints:
    -
      endpoint: 'plan?scopes=tags,locations&activities=false'
      api_version: v2
      auth_method: api_key
  item_selector: data
  fields:
    -
      name: original_id
      label: 'Unique plan ID'
      selector: id
    -
      name: created
      label: 'Created datetime'
      selector: createdAt
    -
      name: updated
      label: 'Updated datetime'
      selector: updatedAt
    -
      name: restricted
      label: 'The restricted flag'
      selector: restricted
    -
      name: plan_status
      label: 'The plan status in RPM'
      selector: planStatus
  ids:
    original_id:
      type: integer
process:
  type:
    plugin: default_value
    default_value: plan
  title: name
  status: status
  created:
    plugin: callback
    callable: strtotime
    source: created
  changed:
    plugin: callback
    callable: strtotime
    source: updated
  field_original_id: original_id
  field_description: comments
  field_plan_version_tag: version_tag
  field_plan_date/value:
    plugin: hpc_api_migrate_format_date
    source: start_date
  field_plan_date/end_value:
    plugin: hpc_api_migrate_format_date
    source: end_date
  field_plan_structure_rpm: prototype
  field_plan_reporting_periods: reporting_periods
  field_country:
    plugin: sub_process
    source: countries
    process:
      target_id:
        plugin: migration_lookup
        migration: country
        source: id
  field_plan_type:
    plugin: migration_lookup
    migration: plan_type_term
    source: plan_type_id
    no_stub: true
  field_plan_costing:
    plugin: migration_lookup
    migration: plan_costing_term
    source: plan_costing_id
    no_stub: true
  field_year: plan_year
  field_restricted: restricted
  field_rpm_plan_status: plan_status
  promote:
    plugin: default_value
    default_value: 0
  sticky:
    plugin: default_value
    default_value: 0
  uid:
    plugin: default_value
    default_value: 0
destination:
  plugin: 'entity:node'
  overwrite_properties:
    - title
    - status
    - created
    - changed
    - field_description
    - field_plan_version_tag
    - field_plan_date
    - field_plan_structure_rpm
    - field_plan_reporting_periods
    - field_plan_type
    - field_plan_costing
    - field_year
    - field_country
    - field_restricted
    - field_rpm_plan_status
migration_dependencies:
  required:
    - plan_type_term
    - plan_costing_term
    - country
